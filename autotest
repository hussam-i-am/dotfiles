# Assume a bundler-managed environment, so find and require the
# autotest-specific enhancement gems directly. This does not do dependency
# tracking, so dependent gems must be explicitly specified!

def autotest_require(gemname, lib=nil)
  # allow bundler or rubygems a fair shake at loading the library first
  require lib ? lib : gemname
rescue LoadError
  # didn't work? we'll do it ourself
  candidates = []

  ENV["GEM_PATH"].split(":").map {|p| p + "/gems" }.each do |path|
    Dir.glob(path + "/*").each do |entry|
      if File.directory?(entry) && File.basename(entry).start_with?(gemname)
        candidates << entry
      end
    end
  end

  if candidates.empty?
    raise LoadError, "could not load #{lib || gemname} via autotest_require"
  else
    $:.push(candidates.sort.reverse.first + "/lib")
    require lib ? lib : gemname
  end
end

autotest_require "sys-uname", "sys/uname"
autotest_require "autotest-fsevent", "autotest/fsevent"

# require "autotest/redgreen"
# require "redgreen/autotest"
# require "autotest/growl"

